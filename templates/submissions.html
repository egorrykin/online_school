{% extends 'base.html' %}

{% block title %}Решения - {{ assignment.title }} - Online School{% endblock %}

{% block content %}
<div class="container">
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{% url 'dashboard' %}">Панель управления</a></li>
      <li class="breadcrumb-item"><a href="{% url 'my_courses' %}">Мои курсы</a></li>
      <li class="breadcrumb-item"><a href="{% url 'course_detail' assignment.course.id %}">{{ assignment.course.title }}</a></li>
      <li class="breadcrumb-item"><a href="{% url 'assignment_detail' assignment.id %}">{{ assignment.title }}</a></li>
      <li class="breadcrumb-item active">Решения</li>
    </ol>
  </nav>

  <div class="card">
    <div class="card-header">
      <h4 class="mb-0">Решения для "{{ assignment.title }}"</h4>
      <div class="mt-2">
        <span class="badge bg-info">Курс: {{ assignment.course.title }}</span>
        <span class="badge bg-secondary ms-2">Всего решений: {{ submissions.count }}</span>
      </div>
    </div>

    <div class="card-body">
      {% if submissions %}
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
          <tr>
            <th>Ученик</th>
            <th>Время отправки</th>
            <th>Статус</th>
            <th>Оценка</th>
            <th>Действия</th>
          </tr>
          </thead>
          <tbody>
          {% for submission in submissions %}
          <tr>
            <td>
              <div class="d-flex align-items-center">
                <div class="avatar-placeholder me-2" style="width: 30px; height: 30px; background: #4facfe; border-radius: 50%; color: white; display: flex; align-items: center; justify-content: center; font-weight: bold;">
                  {{ submission.student.first_name|first|upper }}{{ submission.student.last_name|first|upper }}
                </div>
                <div>
                  <div>{{ submission.student.get_full_name|default:submission.student.username }}</div>
                  <small class="text-muted">{{ submission.student.email }}</small>
                </div>
              </div>
            </td>
            <td>{{ submission.submitted_at|date:"d.m.Y H:i" }}</td>
            <td>
              {% if submission.is_late %}
              <span class="badge bg-danger">С опозданием</span>
              {% else %}
              <span class="badge bg-success">В срок</span>
              {% endif %}
            </td>
            <td>
              {% if submission.grade %}
              <span class="badge bg-success">{{ submission.grade }}/{{ assignment.max_points }}</span>
              {% else %}
              <span class="badge bg-warning">Ожидает проверки</span>
              {% endif %}
            </td>
            <td>
              <a href="{% url 'grade_submission' submission.id %}" class="btn btn-sm btn-primary">
                <i class="fas fa-edit"></i> Проверить
              </a>
            </td>
          </tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="alert alert-info">
        <i class="fas fa-info-circle"></i>
        Пока нет решений от учеников.
      </div>
      {% endif %}

      <div class="mt-3">
        <a href="{% url 'assignment_detail' assignment.id %}" class="btn btn-secondary">
          <i class="fas fa-arrow-left"></i> Назад к заданию
        </a>
      </div>
    </div>
  </div>
</div>
{% endblock %}